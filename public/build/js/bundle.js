$(function(){var t,e=$("body"),a="",i="",n=[],s="";window.initHistoric=function(t,e){getBackofficeUsers(),$(document).on("init.dt",function(t,e){$(".tableHistoric thead tr").find("th:nth-child(1)").removeClass("sorting_asc"),initSearchUserAutoCompleteInput(),initDateRangePickerFilter()});var n=$("#"+e.sTableId).data("pagenumber");t.pageId=n,t.user_name=s,initSelectedActionData(t),""!=a&&(t.startDate=a),""!=i&&(t.endDate=i)},e.on("cancel.daterangepicker","#"+activeTabId+" .tableHistoric",function(t,e){$(this).find('input[name="datefilter"]').val("")}),$("body").on("change",".melisCmsPageHistoricSelectAction",function(){t=$(this).closest(".filter-bar").siblings(".bottom").find("table").attr("id"),$("#"+t).DataTable().ajax.reload()}),$("body").on("apply.daterangepicker",".melisCmsPageHistoricDatePicker",function(){t=$(this).closest(".filter-bar").siblings(".bottom").find("table").attr("id"),$("#"+t).DataTable().ajax.reload()}),window.initSearchUserAutoCompleteInput=function(){$("body").find(".melisCmsPageHistoricSearchUserText").autocomplete({source:n,select:function(e,a){s=a.item.value,t=$(this).closest(".filter-bar").siblings(".bottom").find("table").attr("id"),$("#"+t).DataTable().ajax.reload()}})},window.getBackofficeUsers=function(){n=[],$.ajax({type:"POST",url:"/melis/MelisCmsPageHistoric/PageHistoric/getBackOfficeUsers"}).done(function(t){$.each(t.users,function(t,e){n.push(e.fullname)})})},window.initDateRangePickerFilter=function(){function t(t,e){dStartDate=t.format(melisDateFormat),dEndDate=e.format(melisDateFormat);var n='<i class="glyphicon glyphicon-calendar fa fa-calendar"></i>';""==dStartDate?$("body").find(".melisCmsPageHistoricDatePicker .dt_dateInfo").html(translations.tr_meliscore_datepicker_select_date+" "+n+' <b class="caret"></b>'):$("body").find(".melisCmsPageHistoricDatePicker .dt_dateInfo").html(translations.tr_meliscore_datepicker_select_date+" "+n+" "+dStartDate+" - "+dEndDate+' <b class="caret"></b>'),a=dStartDate,i=dEndDate}a="",i="";var e=translations.tr_meliscore_datepicker_today,n=translations.tr_meliscore_datepicker_yesterday,s=translations.tr_meliscore_datepicker_last_7_days,o=translations.tr_meliscore_datepicker_last_30_days,r=translations.tr_meliscore_datepicker_this_month,c=translations.tr_meliscore_datepicker_last_month,l={};l[e]=[moment(),moment()],l[n]=[moment().subtract(1,"days"),moment().subtract(1,"days")],l[s]=[moment().subtract(6,"days"),moment()],l[o]=[moment().subtract(29,"days"),moment()],l[r]=[moment().startOf("month"),moment().endOf("month")],l[c]=[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")],$("body").find(".melisCmsPageHistoricDatePicker").daterangepicker({locale:{format:melisDateFormat,applyLabel:translations.tr_meliscore_datepicker_apply,cancelLabel:translations.tr_meliscore_datepicker_cancel,customRangeLabel:translations.tr_meliscore_datepicker_custom_range},ranges:l},t)},window.initSelectedActionData=function(e){var a=$("#"+t).closest(".bottom").siblings(".filter-bar").find(".melisCmsPageHistoricSelectAction");a.length&&""!=a.val()&&(e.action=$("#"+t).closest(".bottom").siblings(".filter-bar").find(".melisCmsPageHistoricSelectAction").val())},e.on("click",".melis-openrecenthistoric",function(){var t=$(this).data();melisHelper.tabOpen(t.pageTitle,t.pageIcon,t.zoneId,t.melisKey,{idPage:t.pageId})})});