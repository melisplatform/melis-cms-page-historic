$(function(){var t,e=$("body"),a="",i="",n=[],s="";window.initHistoric=function(t,e){getBackofficeUsers(),$(document).on("init.dt",function(t,e){$(".tableHistoric thead tr").find("th:nth-child(1)").removeClass("sorting_asc"),initSearchUserAutoCompleteInput(),initDateRangePickerFilter()});var n=$("#"+e.sTableId).data("pagenumber");t.pageId=n,t.user_name=s,initSelectedActionData(t),""!=a&&(t.startDate=a),""!=i&&(t.endDate=i)},e.on("cancel.daterangepicker","#"+activeTabId+" .tableHistoric",function(t,e){$(this).find('input[name="datefilter"]').val("")}),e.on("change",".melisCmsPageHistoricSelectAction",function(){var e=$(this);t=e.closest(".filter-bar").siblings(".bottom").find("table").attr("id"),$("#"+t).DataTable().ajax.reload()}),e.on("apply.daterangepicker",".melisCmsPageHistoricDatePicker",function(){var e=$(this);t=e.closest(".filter-bar").siblings(".bottom").find("table").attr("id"),$("#"+t).DataTable().ajax.reload()}),window.initSearchUserAutoCompleteInput=function(){e.find(".melisCmsPageHistoricSearchUserText").autocomplete({source:n,select:function(e,a){s=a.item.value,t=$(this).closest(".filter-bar").siblings(".bottom").find("table").attr("id"),$("#"+t).DataTable().ajax.reload()}})},window.getBackofficeUsers=function(){n=[],$.ajax({type:"POST",url:"/melis/MelisCmsPageHistoric/PageHistoric/getBackOfficeUsers"}).done(function(t){$.each(t.users,function(t,e){n.push(e.fullname)})}).fail(function(){alert(translations.tr_meliscore_error_message)})},window.initDateRangePickerFilter=function(){function t(t,n){dStartDate=t.format(melisDateFormat),dEndDate=n.format(melisDateFormat);var s='<i class="glyphicon glyphicon-calendar fa fa-calendar"></i>';""==dStartDate?e.find(".melisCmsPageHistoricDatePicker .dt_dateInfo").html(translations.tr_meliscore_datepicker_select_date+" "+s+' <strong class="caret"></strong>'):e.find(".melisCmsPageHistoricDatePicker .dt_dateInfo").html(translations.tr_meliscore_datepicker_select_date+" "+s+" "+dStartDate+" - "+dEndDate+' <b class="caret"></b>'),a=dStartDate,i=dEndDate}a="",i="";var n=translations.tr_meliscore_datepicker_today,s=translations.tr_meliscore_datepicker_yesterday,r=translations.tr_meliscore_datepicker_last_7_days,o=translations.tr_meliscore_datepicker_last_30_days,c=translations.tr_meliscore_datepicker_this_month,l=translations.tr_meliscore_datepicker_last_month,m={};m[n]=[moment(),moment()],m[s]=[moment().subtract(1,"days"),moment().subtract(1,"days")],m[r]=[moment().subtract(6,"days"),moment()],m[o]=[moment().subtract(29,"days"),moment()],m[c]=[moment().startOf("month"),moment().endOf("month")],m[l]=[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")],e.find(".melisCmsPageHistoricDatePicker").daterangepicker({locale:{format:melisDateFormat,applyLabel:translations.tr_meliscore_datepicker_apply,cancelLabel:translations.tr_meliscore_datepicker_cancel,customRangeLabel:translations.tr_meliscore_datepicker_custom_range},ranges:m},t)},window.initSelectedActionData=function(e){var a=$("#"+t).closest(".bottom").siblings(".filter-bar").find(".melisCmsPageHistoricSelectAction");a.length&&""!=a.val()&&(e.action=$("#"+t).closest(".bottom").siblings(".filter-bar").find(".melisCmsPageHistoricSelectAction").val())},e.on("click",".melis-openrecenthistoric",function(){var t=$(this),e=t.data();melisHelper.tabOpen(e.pageTitle,e.pageIcon,e.zoneId,e.melisKey,{idPage:e.pageId})}),window.paginateDataTables=function(){melisCore.paginateDataTables()}});