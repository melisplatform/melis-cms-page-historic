$(function(){var t,e=$("body");window.initHistoric=function(t,e){$(document).on("init.dt",function(t,e){$(".tableHistoric thead tr").find("th:nth-child(1)").removeClass("sorting_asc"),initDateRangePickerFilter()});var a=$("#"+e.sTableId).data("pagenumber");t.pageId=a;var i=$("#id_mcph_search_user_form_"+a+" #id_mcph_user_search");t.user_name=i.length>0?i.val():"",initSelectedActionData(t);var r=$("#"+e.sTableId+"_wrapper .melisCmsPageHistoricDatePicker");r.length&&"false"==r.attr("data-is-init")&&null!==(r=r.data("daterangepicker")).startDate&&null!==r.endDate&&(t.startDate=r.startDate.format(melisDateFormat),t.endDate=r.endDate.format(melisDateFormat))},e.on("cancel.daterangepicker","#"+activeTabId+" .tableHistoric",function(t,e){$(this).find('input[name="datefilter"]').val("")}),e.on("change",".melisCmsPageHistoricSelectAction",function(){var e=$(this);t=e.closest(".filter-bar").siblings(".bottom").find("table").attr("id"),$("#"+t).DataTable().ajax.reload()}),e.on("apply.daterangepicker",".melisCmsPageHistoricDatePicker",function(){var t=$(this);t.attr("data-is-init","false");var e=t.closest(".filter-bar").siblings(".bottom").find("table").attr("id");$("#"+e).DataTable().ajax.reload()}),e.on("change",".mcph-user-search",function(){t=$(this).closest(".filter-bar").siblings(".bottom").find("table").attr("id"),$("#"+t).DataTable().ajax.reload()}),window.initDateRangePickerFilter=function(){var t=translations.tr_meliscore_datepicker_today,a=translations.tr_meliscore_datepicker_yesterday,i=translations.tr_meliscore_datepicker_last_7_days,r=translations.tr_meliscore_datepicker_last_30_days,n=translations.tr_meliscore_datepicker_this_month,s=translations.tr_meliscore_datepicker_last_month;var o={};o[t]=[moment(),moment()],o[a]=[moment().subtract(1,"days"),moment().subtract(1,"days")],o[i]=[moment().subtract(6,"days"),moment()],o[r]=[moment().subtract(29,"days"),moment()],o[n]=[moment().startOf("month"),moment().endOf("month")],o[s]=[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")],e.find(".melisCmsPageHistoricDatePicker").daterangepicker({locale:{format:melisDateFormat,applyLabel:translations.tr_meliscore_datepicker_apply,cancelLabel:translations.tr_meliscore_datepicker_cancel,customRangeLabel:translations.tr_meliscore_datepicker_custom_range},ranges:o},function(t,a){dStartDate=t.format(melisDateFormat),dEndDate=a.format(melisDateFormat);var i='<i class="glyphicon glyphicon-calendar fa fa-calendar"></i>';""==dStartDate?e.find(".melisCmsPageHistoricDatePicker .dt_dateInfo").html(translations.tr_meliscore_datepicker_select_date+" "+i+' <strong class="caret"></strong>'):e.find(".melisCmsPageHistoricDatePicker .dt_dateInfo").html(translations.tr_meliscore_datepicker_select_date+" "+i+" "+dStartDate+" - "+dEndDate+' <b class="caret"></b>')})},window.initSelectedActionData=function(e){var a=$("#"+t).closest(".bottom").siblings(".filter-bar").find(".melisCmsPageHistoricSelectAction");a.length&&""!=a.val()&&(e.action=$("#"+t).closest(".bottom").siblings(".filter-bar").find(".melisCmsPageHistoricSelectAction").val())},e.on("click",".melis-openrecenthistoric",function(){var t=$(this).data();melisHelper.tabOpen(t.pageTitle,t.pageIcon,t.zoneId,t.melisKey,{idPage:t.pageId})})});
